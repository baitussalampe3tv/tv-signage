<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>TV Signage (Mobile) â€“ Masjid</title>
<style>
  :root{
    --bg1:#E8FFF7; --bg2:#D9F7F0;
    --panel:#F4FBF8; --border:#B6E2D5;
    --gold:#C9A23C; --text:#102A27; --muted:#3A5F58;
    --tickerBg:#0B1C53; --tickerText:#FFFFFF;
    --shadow:0 10px 28px rgba(0,0,0,.16);
  }
  body.theme-emerald{
    --bg1:#0d2d28; --bg2:#134238; --panel:#123a32; --border:#2f6b5e;
    --gold:#e8c15a; --text:#EAF7F3; --muted:#bfe4d8;
    --tickerBg:#0f3b34; --tickerText:#fdfdfd;
    --shadow:0 14px 36px rgba(0,0,0,.28);
  }
  body.theme-gold{
    --bg1:#fff7e0; --bg2:#ffefc6; --panel:#fff8e8; --border:#f0db9a;
    --gold:#d5a921; --text:#2b240f; --muted:#5b4d1d;
    --tickerBg:#7a5a12; --tickerText:#fffaf0;
    --shadow:0 14px 36px rgba(0,0,0,.18);
  }

  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);font-family:Inter,"Segoe UI",Roboto,system-ui,Arial,sans-serif}
  /* konten mobile scrollable */
  .page{min-height:100%; display:flex; flex-direction:column}
  .pad{padding:12px 14px 18px}

  /* HEADER sticky */
  .topbar{position:sticky; top:0; z-index:8; padding:10px 12px; backdrop-filter:blur(8px);
    background:linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.08)); border-bottom:1px solid var(--border)}
  .brand{display:flex; gap:10px; align-items:center}
  .brand img{height:34px}
  .brand .txt{line-height:1.05}
  .brand .name{font-size:16px; font-weight:900}
  .brand .sub{font-size:12px; font-weight:700; color:var(--muted)}

  /* WAKTU SHOLAT */
  .prayer{display:grid; gap:10px; padding:12px; margin:12px; background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08));
    border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow)}
  .phdr{font-weight:900; font-size:15px}
  .pt{display:grid; grid-template-columns: repeat(3, auto auto); gap:6px 12px}
  .pt .name{color:var(--muted); font-weight:800}
  .pt .time{font-weight:900}
  .nextRow{display:flex; justify-content:space-between; align-items:center; gap:10px; padding-top:6px; border-top:1px dashed var(--border)}
  .next{font-weight:900; color:var(--gold)}
  .cd{font-weight:900}

  /* SLIDES area */
  .card{margin:0 12px 12px; background:var(--panel); border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); overflow:hidden}
  .frame{position:relative; width:100%; min-height:38vh; background:linear-gradient(180deg, rgba(0,0,0,.04), rgba(0,0,0,.08))}
  .frame img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .6s}
  .frame img.show{opacity:1}
  .caption{position:absolute; left:10px; right:10px; bottom:10px; background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.35)); color:#fff; border-radius:10px; padding:10px 12px}
  .cap-title{margin:0 0 4px; font-size:clamp(16px,4.2vw,22px); font-weight:900}
  .cap-desc{margin:0; font-size:clamp(13px,3.8vw,18px); font-weight:600}

  /* QUOTE */
  .qcard{margin:0 12px 12px; border-radius:14px; border:1px solid var(--border); box-shadow:var(--shadow);
    background:
      radial-gradient(700px 240px at 30% 0%, rgba(231, 196, 94, .25), transparent 60%),
      linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.55)),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="300" viewBox="0 0 600 300"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="%23c79d2b"/><stop offset="1" stop-color="%23e6c86a"/></linearGradient></defs><g fill="none" stroke="url(%23g)" stroke-opacity=".2"><path d="M0 60 C150 120 450 0 600 60" /><path d="M0 140 C150 200 450 80 600 140" /><path d="M0 220 C150 280 450 160 600 220" /></g></svg>') center/cover no-repeat;
    color:#fff; padding:18px 16px}
  .qtext{margin:0 0 8px; font-weight:900; color:var(--gold); text-shadow:0 2px 6px rgba(0,0,0,.6); font-size:clamp(18px,5.5vw,28px); text-align:center}
  .qsrc{margin:0; text-align:center; color:#fff; opacity:.95; font-weight:800; font-size:clamp(14px,4.4vw,18px)}

  /* VIDEO (fit 16:9) */
  .vcard{margin:0 12px 12px; border-radius:14px; border:1px solid var(--border); box-shadow:var(--shadow); overflow:hidden; background:#000}
  .vwrap{position:relative; width:100%; height:0; padding-bottom:56.25%} /* 16:9 */
  .vwrap > *{position:absolute; inset:0; width:100%; height:100%; display:block}

  /* FINANCE */
  .fcard{margin:0 12px 12px; padding:16px; border-radius:14px; border:1px solid var(--border); box-shadow:var(--shadow);
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.08)); color:#fff}
  .ftitle{margin:0 0 10px; text-align:center; color:var(--gold); font-weight:900; font-size:clamp(18px,5.4vw,26px)}
  #finCanvas{width:100%; height:42vh; background:rgba(0,0,0,.18); border-radius:10px}

  /* SCHEDULE */
  .scard{margin:0 12px 12px; padding:16px; border-radius:14px; border:1px solid var(--border); box-shadow:var(--shadow);
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.08)); color:#fff}
  .stitle{margin:0 0 10px; text-align:center; color:var(--gold); font-weight:900; font-size:clamp(18px,5.4vw,26px)}
  .slist{display:grid; gap:10px}
  .srow{display:grid; grid-template-columns: 1fr; gap:6px; background:rgba(0,0,0,.22); border:1px solid rgba(255,255,255,.18); border-radius:10px; padding:10px 12px}
  .srow .time{font-weight:900; font-size:clamp(14px,4.2vw,18px)}
  .srow .topic{font-weight:800; font-size:clamp(14px,4vw,18px)}
  .srow .ust{font-weight:700; opacity:.95; font-size:clamp(13px,3.8vw,17px)}

  /* TICKER sticky bottom */
  .ticker{position:sticky; bottom:0; z-index:9; background:var(--tickerBg); color:var(--tickerText); min-height:40px; overflow:hidden}
  .tkInner{white-space:nowrap; will-change:transform; padding:0 100vw 0 0}
  .tkText{display:inline-block; padding:10px 16px; font-size:clamp(13px,3.6vw,16px); font-weight:800}

  /* spasi ekstra agar ticker tidak menimpa konten */
  .spacer{height:12px}
</style>
</head>
<body class="theme-gold">
<div class="page">

  <!-- HEADER -->
  <div class="topbar">
    <div class="brand">
      <img src="logo.png" alt="Logo">
      <div class="txt">
        <div class="name">Masjid Baitussalam</div>
        <div class="sub">Premier Estate 3</div>
      </div>
    </div>
  </div>

  <!-- WAKTU SHOLAT -->
  <section class="prayer" id="prayerBox">
    <div class="phdr">Waktu Sholat</div>
    <div class="pt" id="pt"></div>
    <div class="nextRow"><div class="next" id="next">Selanjutnya: -</div><div class="cd" id="cd">--:--:--</div></div>
  </section>

  <!-- SLIDES (gambar) -->
  <section class="card">
    <div class="frame" id="frame"></div>
  </section>

  <!-- QUOTE (akan diganti kontennya saat rotasi) -->
  <section class="qcard" id="qcard" style="display:none">
    <p class="qtext" id="qtext"></p>
    <p class="qsrc" id="qsrc"></p>
  </section>

  <!-- VIDEO -->
  <section class="vcard" id="vcard" style="display:none">
    <div class="vwrap" id="vwrap">
      <!-- akan diisi <iframe> (YouTube) atau <video> (MP4) sesuai item -->
    </div>
  </section>

  <!-- FINANCE -->
  <section class="fcard" id="fcard" style="display:none">
    <h3 class="ftitle" id="ftitle">Laporan Keuangan</h3>
    <canvas id="finCanvas"></canvas>
  </section>

  <!-- SCHEDULE -->
  <section class="scard" id="scard" style="display:none">
    <h3 class="stitle">Jadwal Kajian</h3>
    <div class="slist" id="slist"></div>
  </section>

  <!-- spacer untuk ticker -->
  <div class="spacer"></div>

  <!-- TICKER -->
  <div class="ticker" id="ticker" style="display:none">
    <div class="tkInner" id="tkInner"><span class="tkText" id="tkText"></span></div>
  </div>

</div>

<script>
(function(){
  const qs=new URLSearchParams(location.search);

  /* ===== Theme ===== */
  (function setTheme(){
    const th=(qs.get("theme")||"gold").toLowerCase();
    document.body.className = `theme-${["emerald","gold"].includes(th)?th:"gold"}`;
  })();

  /* ===== Params ===== */
  const configUrl=qs.get("config") || "signage.json";
  const refreshMin=parseFloat(qs.get("refreshMin")||"5");
  const tickerParam=qs.get("ticker");
  const showTickerQ=["1","true","yes","on"].includes((qs.get("showTicker")||"").toLowerCase());
  const tickerPauseSec = parseFloat(qs.get("tickerPauseSec")||"2");
  const tickerSpeed = parseFloat(qs.get("tickerSpeed")||"90"); // lebih pelan utk mobile

  /* ===== Elements ===== */
  const frameEl=document.getElementById("frame");
  const qcard=document.getElementById("qcard");
  const qtext=document.getElementById("qtext");
  const qsrc =document.getElementById("qsrc");
  const vcard=document.getElementById("vcard");
  const vwrap=document.getElementById("vwrap");
  const fcard=document.getElementById("fcard");
  const finCanvas=document.getElementById("finCanvas");
  const ftitle=document.getElementById("ftitle");
  const scard=document.getElementById("scard");
  const slist=document.getElementById("slist");

  const ticker=document.getElementById("ticker");
  const tkInner=document.getElementById("tkInner");
  const tkText=document.getElementById("tkText");

  const ptEl=document.getElementById("pt");
  const nextEl=document.getElementById("next");
  const cdEl=document.getElementById("cd");

  /* ===== Data ===== */
  let slides=[],imgs=[],quotes=[],videos=[],finance=null,schedule=[];
  let settings={overlayRotationSec:12,overlayShowSec:10};
  let imgPtr=0, qPtr=0, vPtr=0;
  let imgTimer=null, rotTimer=null, tickerRunning=false;

  /* ===== Helpers ===== */
  const isImg   = s => !!s.url;
  const isQuote = s => !!s.quote;
  const isVideo = s => !!s.video;

  /* cache-buster + base */
  function baseOf(urlStr){
    try{ const u=new URL(urlStr, location.href); u.hash=""; u.search=""; return u.href.replace(/[^/]+$/,""); }
    catch(_){ return ""; }
  }
  const __configBase = baseOf(configUrl);
  const __bust = qs.get("t") || "";
  function resolveAsset(u){
    if(!u) return "";
    if(/^https?:\/\//i.test(u) || /^data:/i.test(u)) return u;
    if(u.startsWith("/")) return u;
    return __configBase ? (__configBase + u) : u;
  }
  function withBust(u){
    if(!__bust) return u;
    try{ const url=new URL(u, location.href); url.searchParams.set("v", __bust); return url.toString(); }
    catch(_){ return u + (u.includes("?")?"&":"?") + "v="+encodeURIComponent(__bust); }
  }

  /* ===== Slides (gambar) ===== */
  function mountImage(item){
    frameEl.innerHTML="";
    const im=new Image();
    im.decoding="async"; im.loading="eager";
    im.src = withBust(resolveAsset(item.url));
    im.onerror = ()=>{ im.style.opacity=1; im.style.objectFit="contain"; im.style.background="#0002"; };
    frameEl.appendChild(im);
    requestAnimationFrame(()=> im.classList.add("show"));
  }
  function nextImage(){
    if(imgs.length===0) return;
    const it=imgs[imgPtr]; imgPtr=(imgPtr+1)%imgs.length;
    mountImage(it);
    const dur = Number(it.durationSec||8);
    clearTimeout(imgTimer); imgTimer=setTimeout(nextImage, Math.max(3,dur)*1000);
  }

  /* ===== Quote ===== */
  function showQuote(item){
    if(!item) return;
    qtext.textContent = item.quote||"";
    qsrc.textContent  = item.source||"";
    qcard.style.display="block";
    const dur = Number(item.durationSec||settings.overlayShowSec);
    setTimeout(()=>{ qcard.style.display="none"; }, Math.max(3,dur)*1000);
  }

  /* ===== Video (YT / MP4) ===== */
  function isYouTubeUrl(u){ return /(?:youtube\.com|youtu\.be)/i.test(u||""); }
  function extractYouTube(u){
    try{
      const url=new URL(u);
      let id="", start=0;
      const toSec=(t)=>{ if(!t) return 0; if(/^\d+$/.test(t)) return +t; let s=0; const h=/(\d+)h/i.exec(t); if(h)s+=+h[1]*3600; const m=/(\d+)m/i.exec(t); if(m)s+=+m[1]*60; const sc=/(\d+)s/i.exec(t); if(sc)s+=+sc[1]; return s; };
      if(url.hostname.includes("youtu.be")){ id=url.pathname.replace(/^\/+/,""); start=toSec(url.searchParams.get("t")); }
      else if(url.pathname.startsWith("/watch")){ id=url.searchParams.get("v")||""; start=toSec(url.searchParams.get("t")); }
      else if(url.pathname.startsWith("/embed/")){ id=url.pathname.split("/").pop(); start=toSec(url.searchParams.get("start")||url.searchParams.get("t")); }
      return id?{id,start}:null;
    }catch(_){ return null; }
  }
  function showVideo(item){
    vwrap.innerHTML="";
    vcard.style.display="block";
    const dur = Number(item.durationSec||settings.overlayShowSec||15);

    if(isYouTubeUrl(item.video||"")){
      const ex=extractYouTube(item.video);
      if(!ex){ vcard.style.display="none"; return; }
      const src = `https://www.youtube-nocookie.com/embed/${ex.id}?autoplay=1&mute=1&controls=0&rel=0&playsinline=1&modestbranding=1&iv_load_policy=3&cc_load_policy=1&start=${ex.start||0}`;
      const ifr=document.createElement("iframe");
      ifr.src=src; ifr.allow="autoplay; encrypted-media; picture-in-picture"; ifr.setAttribute("frameborder","0");
      vwrap.appendChild(ifr);
    }else{
      const vid=document.createElement("video");
      vid.muted=true; vid.playsInline=true; vid.autoplay=true; vid.controls=false;
      vid.src = withBust(resolveAsset(item.video));
      vwrap.appendChild(vid);
      vid.play().catch(()=>{});
    }
    setTimeout(()=>{ vcard.style.display="none"; vwrap.innerHTML=""; }, Math.max(4,dur)*1000);
  }

  /* ===== Finance ===== */
  function drawFinance(){
    const c=finCanvas, dpr=window.devicePixelRatio||1, w=c.clientWidth, h=c.clientHeight;
    c.width=Math.floor(w*dpr); c.height=Math.floor(h*dpr);
    const ctx=c.getContext('2d'); ctx.scale(dpr,dpr); ctx.clearRect(0,0,w,h);

    const pad=16, labels=finance.labels||[], data=finance.data||[];
    const maxV=Math.max(1, ...data.map(v=>Math.abs(v)));
    const barW=(w-pad*2)/(labels.length*1.6), gap=barW*0.6, baseY=h-pad-24, scale=(h-pad*2-36)/maxV;

    ctx.strokeStyle="rgba(255,255,255,.2)"; ctx.lineWidth=1; ctx.beginPath();
    for(let i=0;i<=3;i++){ const y=pad+i*((baseY-pad)/3); ctx.moveTo(pad,y); ctx.lineTo(w-pad,y); } ctx.stroke();

    labels.forEach((lab,i)=>{
      const v=data[i]||0, bh=v*scale, x=pad+i*(barW+gap), y=baseY-bh;
      ctx.fillStyle="#e8c15a"; ctx.fillRect(x,y,barW,bh);

      const labelFont = Math.max(12, Math.round(w/22));
      ctx.fillStyle="#fff"; ctx.font = `${labelFont}px Inter, Arial`; ctx.textAlign="center";
      ctx.fillText(lab, x+barW/2, baseY+14);

      const valueFont = Math.max(13, Math.round(w/20));
      ctx.fillStyle="#e8c15a"; ctx.font = `bold ${valueFont}px Inter, Arial`;
      ctx.fillText(formatRupiah(v), x+barW/2, Math.max(14,y-6));
    });
  }

  /* ===== Schedule ===== */
  function renderSchedule(){
    slist.innerHTML="";
    schedule.forEach(it=>{
      const row=document.createElement('div'); row.className="srow";
      row.innerHTML=`<div class="time">${it.time||""}</div><div class="topic">${it.topic||""}</div><div class="ust">${it.ustadz||""}</div>`;
      slist.appendChild(row);
    });
  }

  /* ===== Rotasi overlay (quote / video / finance / schedule) ===== */
  function startRotation(){
    if(rotTimer){ clearInterval(rotTimer); rotTimer=null; }
    const order = (cfg?.overlaysOrder && cfg.overlaysOrder.length) ? cfg.overlaysOrder
                  : ["video","finance","schedule","quote"];
    const rotSec = Math.max(6, Number(settings.overlayRotationSec||12));
    let idx=0;
    rotTimer=setInterval(()=>{
      const kind = order[idx%order.length]; idx++;
      if(kind==="quote" && quotes.length){ const q=quotes[qPtr]; qPtr=(qPtr+1)%quotes.length; showQuote(q); }
      else if(kind==="video" && videos.length){ const v=videos[vPtr]; vPtr=(vPtr+1)%videos.length; showVideo(v); }
      else if(kind==="finance" && finance){ fcard.style.display="block"; drawFinance(); setTimeout(()=>fcard.style.display="none", (finance.durationSec||settings.overlayShowSec)*1000); }
      else if(kind==="schedule" && schedule.length){ scard.style.display="block"; renderSchedule(); setTimeout(()=>scard.style.display="none", (settings.overlayShowSec)*1000); }
    }, rotSec*1000);
  }

  /* ===== Ticker ===== */
  function startTicker(){
    if(tickerRunning) return; tickerRunning=true;
    const run=()=>{
      tkInner.style.transition="none";
      tkInner.style.transform=`translateX(${window.innerWidth}px)`;
      requestAnimationFrame(()=>{
        const width=tkInner.getBoundingClientRect().width;
        const total=width + window.innerWidth;
        const dur= total / Math.max(50, tickerSpeed);
        tkInner.style.transition=`transform ${dur}s linear`;
        tkInner.style.transform=`translateX(-${width}px)`;
        tkInner.ontransitionend = ()=> setTimeout(run, Math.max(0,tickerPauseSec)*1000);
      });
    };
    run();
  }

  /* ===== Jadwal Sholat ===== */
  const tz="Asia/Jakarta";
  let pTimes=null;

  function parseLcl(hhmm){
    const [H,M]=hhmm.split(":").map(Number);
    const d=new Date(new Date().toLocaleString('en-US',{timeZone:tz}));
    d.setHours(H,M,0,0); return d;
  }
  async function loadPrayer(){
    const today=new Date();
    const y=today.toLocaleString('en-CA',{year:'numeric',timeZone:tz});
    const m=today.toLocaleString('en-CA',{month:'2-digit',timeZone:tz});
    const d=today.toLocaleString('en-CA',{day:'2-digit',timeZone:tz});
    try{
      const r=await fetch(`https://api.myquran.com/v2/sholat/jadwal/1301/${y}/${m}/${d}`,{cache:'no-store'});
      if(r.ok){ const j=await r.json(); const t=j?.data?.jadwal;
        if(t){ pTimes={Fajr:parseLcl(t.subuh), Syuruq:parseLcl(t.terbit), Dhuhr:parseLcl(t.dzuhur), Asr:parseLcl(t.ashar), Maghrib:parseLcl(t.maghrib), Isha:parseLcl(t.isya)}; return true; }
      }
    }catch(_){}
    try{
      const r=await fetch(`https://api.aladhan.com/v1/timingsByCity?city=Jakarta&country=Indonesia&method=3`,{cache:'no-store'});
      if(r.ok){ const j=await r.json(); const t=j?.data?.timings;
        if(t){ pTimes={Fajr:parseLcl(t.Fajr), Syuruq:parseLcl(t.Sunrise), Dhuhr:parseLcl(t.Dhuhr), Asr:parseLcl(t.Asr), Maghrib:parseLcl(t.Maghrib), Isha:parseLcl(t.Isha)}; return true; }
      }
    }catch(_){}
    return false;
  }
  function renderPrayerTable(){
    if(!pTimes){ ptEl.innerHTML='<span style="opacity:.7">Jadwal sholat tidak tersedia</span>'; return; }
    const order=["Fajr","Syuruq","Dhuhr","Asr","Maghrib","Isha"];
    const nameMap={Fajr:"Subuh",Syuruq:"Syuruq",Dhuhr:"Zuhur",Asr:"Asar",Maghrib:"Maghrib",Isha:"Isya"};
    function fmt(d){const hh=String(d.getHours()).padStart(2,"0"),mm=String(d.getMinutes()).padStart(2,"0");return `${hh}:${mm}`;}
    ptEl.innerHTML="";
    order.forEach(k=>{
      const nm=document.createElement("div"); nm.className="name"; nm.textContent=nameMap[k];
      const tm=document.createElement("div"); tm.className="time"; tm.textContent=fmt(pTimes[k]);
      ptEl.append(nm,tm);
    });
  }
  function updateNextHeader(){
    if(!pTimes) return;
    const order=["Fajr","Syuruq","Dhuhr","Asr","Maghrib","Isha"];
    const nameMap={Fajr:"Subuh",Syuruq:"Syuruq",Dhuhr:"Zuhur",Asr:"Asar",Maghrib:"Maghrib",Isha:"Isya"};
    const now=new Date(new Date().toLocaleString('en-US',{timeZone:tz}));
    let nextKey=null;
    for(const k of order){ if(now < pTimes[k]){ nextKey=k; break; } }
    if(!nextKey) nextKey="Fajr";
    const target = pTimes[nextKey] < now ? new Date(pTimes[nextKey].getTime()+86400000) : pTimes[nextKey];
    const diff=target-now;
    const h=String(Math.floor(diff/3600000)).padStart(2,'0');
    const m=String(Math.floor((diff%3600000)/60000)).padStart(2,'0');
    const s=String(Math.floor((diff%60000)/1000)).padStart(2,'0');
    nextEl.textContent="Selanjutnya: "+nameMap[nextKey];
    cdEl.textContent=`${h}:${m}:${s}`;
  }

  /* ===== Config ===== */
  async function fetchConfig(){ try{ const r=await fetch(configUrl,{cache:'no-store'}); if(!r.ok) return null; return await r.json(); }catch(_){ return null; } }
  function applyConfig(cfg){
    if(cfg?.settings)  settings = Object.assign(settings, cfg.settings);

    // slides
    if(cfg && Array.isArray(cfg.slides)){
      slides = cfg.slides.map(s=>{
        const base={durationSec:Number(s.durationSec||8)};
        if(s.quote){ return {...base, quote:String(s.quote), source:s.source||""}; }
        if(s.video){
          const vv = String(s.video).trim();
          return {...base, video: /^https?:\/\//i.test(vv) ? vv : withBust(resolveAsset(vv))};
        }
        if(s.url){
          const uu = String(s.url).trim();
          return {...base, url: withBust(resolveAsset(uu)), title:s.title||"", desc:s.desc||""};
        }
        return null;
      }).filter(Boolean);
    } else {
      slides = [];
    }
    imgs   = slides.filter(isImg);
    quotes = slides.filter(isQuote);
    videos = slides.filter(isVideo);

    // finance & schedule
    finance  = cfg?.finance || null;
    if(finance && finance.title) ftitle.textContent = finance.title;
    schedule = Array.isArray(cfg?.schedule) ? cfg.schedule : [];

    // mulai slideshow gambar
    if(imgs.length){ imgPtr=0; nextImage(); }

    // rotasi overlay
    startRotation();

    // ticker
    const t = tickerParam ?? cfg?.ticker;
    const s = showTickerQ || !!cfg?.showTicker || !!t;
    if (s && t) { ticker.style.display="block"; tkText.textContent=t; startTicker(); }
    else { ticker.style.display="none"; }
  }

  /* ===== Utils ===== */
  function formatRupiah(n){
    try{ return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n); }
    catch(_){ return "Rp " + (n||0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.'); }
  }

  /* ===== Init ===== */
  let cfg=null;
  (async function init(){
    await loadPrayer();
    renderPrayerTable();
    setInterval(()=>{ renderPrayerTable(); updateNextHeader(); }, 1000);

    cfg=await fetchConfig(); applyConfig(cfg||{});
    if(refreshMin>0 && configUrl){
      setInterval(async()=>{ const c=await fetchConfig(); if(c) applyConfig(c); }, refreshMin*60*1000);
    }
  })();
})();
</script>
</body>
</html>

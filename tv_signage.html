<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TV Signage â€“ Masjid</title>
<style>
  :root{--bg1:#E8FFF7;--bg2:#D9F7F0;--panel:#F4FBF8;--border:#B6E2D5;--gold:#C9A23C;--text:#102A27;--muted:#3A5F58;--shadow:0 12px 40px rgba(0,0,0,.16);--tickerBg:#0B1C53;--tickerText:#FFFFFF}
  body.theme-gold{--bg1:#fff7e0;--bg2:#ffefc6;--panel:#fff8e8;--border:#f0db9a;--gold:#d5a921;--text:#2b240f;--muted:#5b4d1d;--shadow:0 16px 48px rgba(0,0,0,.18);--tickerBg:#7a5a12;--tickerText:#fffaf0}
  body.theme-emerald{--bg1:#0d2d28;--bg2:#134238;--panel:#123a32;--border:#2f6b5e;--gold:#e8c15a;--text:#EAF7F3;--muted:#bfe4d8;--shadow:0 16px 48px rgba(0,0,0,.28);--tickerBg:#0f3b34;--tickerText:#fdfdfd}
  html,body{height:100%;margin:0;overflow:hidden;font-family:Inter,"Segoe UI",Roboto,system-ui,Arial,sans-serif}
  body{background:linear-gradient(180deg, var(--bg1), var(--bg2));}
  #stage{position:relative;margin:120px 16px 60px;border-radius:22px;box-shadow:var(--shadow);overflow:hidden;display:grid;place-items:center;min-height:min(70vh,820px)}
  .board{display:grid;grid-template-columns:2fr 1fr;gap:22px;width:min(92vw,1680px);height:min(70vh,820px);padding:22px}
  .frame{position:relative;border-radius:14px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.18)}
  .frame img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .6s}
  .frame img.show{opacity:1}
  .caption{position:absolute;left:14px;right:14px;bottom:14px;padding:12px 14px;background:rgba(0,0,0,.4);color:#fff;border-radius:10px}
  .cap-title{font-weight:900;font-size:clamp(18px,2vw,26px);margin:0 0 4px}
  .cap-desc{font-weight:600;font-size:clamp(14px,1.4vw,18px);margin:0}
  /* Overlays */
  #quoteOverlay,#videoOverlay,#financeOverlay,#scheduleOverlay,#prayerOverlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:20}
  .qwrap{max-width:80%;background:rgba(0,0,0,.65);border-radius:18px;padding:28px 34px;color:var(--gold)}
  .qtext{font-weight:900;font-size:clamp(28px,3.4vw,64px);line-height:1.4;text-align:center;color:var(--gold);text-shadow:0 3px 8px rgba(0,0,0,.85)}
  .qsrc{font-weight:700;font-size:clamp(18px,2vw,30px);text-align:center;color:#fff}
  #videoOverlay video{max-width:92vw;max-height:70vh;border-radius:16px}
  .fcard,.scard{padding:28px 34px;border-radius:22px;background:rgba(0,0,0,.6);color:#fff;text-align:center}
  #finCanvas{width:min(86vw,1400px);height:min(48vh,520px)}
  .slist{display:grid;gap:10px}
  .srow{display:grid;grid-template-columns:120px 1fr 1fr;gap:14px;padding:12px 14px;background:rgba(255,255,255,.1);border-radius:12px}
  .pCard{padding:30px 40px;border-radius:22px;background:rgba(0,0,0,.7);color:#fff;text-align:center}
  #ticker{display:none;position:fixed;left:0;right:0;bottom:0;background:var(--tickerBg);color:var(--tickerText);min-height:48px;align-items:center;overflow:hidden}
  #tickerInner{white-space:nowrap;will-change:transform;padding:0 100vw 0 0}
  #tickerText{display:inline-block;padding:12px 28px;font-size:clamp(16px,1.6vw,22px);font-weight:800}
</style>
</head>
<body class="theme-gold">
<div id="stage">
  <div class="board" id="board">
    <div class="frame" id="frameA"></div>
    <div class="frame" id="frameB"></div>
    <div class="frame" id="frameC"></div>
  </div>

  <div id="quoteOverlay"><div class="qwrap"><p id="qtext"></p><p id="qsrc"></p></div></div>
  <div id="videoOverlay"><video id="vplayer" playsinline muted></video></div>
  <div id="financeOverlay"><div class="fcard"><div id="ftitle">Laporan Keuangan</div><canvas id="finCanvas"></canvas></div></div>
  <div id="scheduleOverlay"><div class="scard"><div>Jadwal Kajian</div><div class="slist" id="slist"></div></div></div>
  <div id="prayerOverlay"><div class="pCard"><div id="pName"></div><div id="pTimer"></div></div></div>
</div>

<div id="ticker"><div id="tickerInner"><span id="tickerText"></span></div></div>

<script>
(function(){
  const qs=new URLSearchParams(location.search);
  const configUrl=qs.get("config")||"signage.json";
  const tickerParam=qs.get("ticker");
  const showTicker=["1","true"].includes((qs.get("showTicker")||"").toLowerCase());

  const board=_("board"),frameA=_("frameA"),frameB=_("frameB"),frameC=_("frameC");
  const quoteOverlay=_("quoteOverlay"),qtext=_("qtext"),qsrc=_("qsrc");
  const videoOverlay=_("videoOverlay"),vplayer=_("vplayer");
  const financeOverlay=_("financeOverlay"),finCanvas=_("finCanvas"),ftitle=_("ftitle");
  const scheduleOverlay=_("scheduleOverlay"),slist=_("slist");
  const ticker=_("ticker"),tickerInner=_("tickerInner"),tickerText=_("tickerText");
  function _(id){return document.getElementById(id)}

  let slides=[],imgs=[],quotes=[],videos=[],finance=null,schedule=[];
  const isImg=s=>!!s.url,isQuote=s=>!!s.quote,isVideo=s=>!!s.video;
  function createImg(src){const i=new Image();i.src=src;return i}
  function mountFrame(f,s){f.innerHTML="";const img=createImg(s.url);f.appendChild(img);
    const cap=document.createElement("div");cap.className="caption";
    cap.innerHTML=`<div class="cap-title">${s.title||""}</div><div class="cap-desc">${s.desc||""}</div>`;f.appendChild(cap);
    requestAnimationFrame(()=>img.classList.add("show"));}

  function showQuoteFullscreen(item,d){hideAllOverlays();board.style.display="none";
    quoteOverlay.style.display="flex";qtext.textContent=item.quote;qsrc.textContent=item.source||"";
    setTimeout(()=>{quoteOverlay.style.display="none";board.style.display="grid";},(d||10)*1000);}
  function showVideoFullscreen(item){hideAllOverlays();board.style.display="none";
    videoOverlay.style.display="flex";vplayer.src=item.video;vplayer.play();
    vplayer.onended=()=>{videoOverlay.style.display="none";board.style.display="grid";};}
  function showFinance(){if(!finance)return;hideAllOverlays();board.style.display="none";
    financeOverlay.style.display="flex";drawFinance();
    setTimeout(()=>{financeOverlay.style.display="none";board.style.display="grid";},(finance.durationSec||10)*1000);}
  function showSchedule(){if(!schedule.length)return;hideAllOverlays();board.style.display="none";
    scheduleOverlay.style.display="flex";slist.innerHTML="";schedule.forEach(it=>{
      slist.innerHTML+=`<div class="srow"><div>${it.time}</div><div>${it.topic}</div><div>${it.ustadz}</div></div>`});
    setTimeout(()=>{scheduleOverlay.style.display="none";board.style.display="grid";},10000);}

  function hideAllOverlays(){quoteOverlay.style.display="none";videoOverlay.style.display="none";financeOverlay.style.display="none";scheduleOverlay.style.display="none";}

  function drawFinance(){const c=finCanvas,w=c.clientWidth,h=c.clientHeight;const ctx=c.getContext("2d");ctx.clearRect(0,0,w,h);
    if(!finance)return;const max=Math.max(...finance.data);const bw=w/finance.data.length*0.6;
    finance.data.forEach((v,i)=>{const x=i*(bw*1.6)+20;const y=h-(v/max)*(h-40);ctx.fillStyle="#e8c15a";ctx.fillRect(x,y,bw,h-y-20);ctx.fillStyle="#fff";ctx.fillText(finance.labels[i],x+bw/2,h-5);});}

  function startTicker(){tickerInner.style.transition="none";tickerInner.style.transform=`translateX(${window.innerWidth}px)`;
    requestAnimationFrame(()=>{const width=tickerInner.getBoundingClientRect().width;const dur=(width+window.innerWidth)/80;
      tickerInner.style.transition=`transform ${dur}s linear`;tickerInner.style.transform=`translateX(-${width}px)`;tickerInner.ontransitionend=()=>startTicker();});}

  async function fetchConfig(){try{const r=await fetch(configUrl);return r.ok?await r.json():null}catch(_){return null}}
  function applyConfig(cfg){
    slides=cfg?.slides||[];imgs=slides.filter(isImg);quotes=slides.filter(isQuote);videos=slides.filter(isVideo);
    finance=cfg?.finance||null;schedule=cfg?.schedule||[];
    if(quotes.length) showQuoteFullscreen(quotes[0],quotes[0].durationSec);
    if(cfg?.ticker || tickerParam){ticker.style.display="flex";tickerText.textContent=tickerParam||cfg.ticker;startTicker();}
  }
  (async()=>{const cfg=await fetchConfig();if(cfg)applyConfig(cfg)})();
})();
</script>
</body>
</html>
